---
title: "Austin Animal Shelter Case Study"
author: "Catalina Barbu"
date: "23 January 2023"
output: 
  html_document:
    theme: journal
    highlight: tango
---

```{r setup, include = FALSE}
library(readr)
library(stringr)
library(tidyverse)
library(scales)
library(kaggler)
library(huxtable)
```

Austin Animal Center is the municipal shelter for the City of Austin, Texas, and it houses thousands of animals while offering services for pet resources and animal safety. Animals of any age, condition, species, or breed, whether strays or owned, are accepted. 

In this study case, I will explore the data from Austin Animal Center to check for criteria that determine the continuity of pets' lives. The data is gathered from Jack Daoud's dataset "Austin Animal Center Shelter Intakes and Outcomes" found on Kaggle.


```{r warning=FALSE, include=FALSE}
data <- kgl_datasets_download_all('aaronschlegel/austin-animal-center-shelter-intakes-and-outcomes')
download.file(data[["url"]], "data/temp.zip", mode="wb")
unzip_result <- unzip("data/temp.zip", exdir = "data/", overwrite = TRUE)
shelter_data <- read_csv( "data/aac_intakes_outcomes.csv") 
unlink(c('data/temp.zip','data/aac_intakes.csv','data/aac_outcomes.csv'))
remove(list=c( "data","unzip_result"))
```

## Preparing the data

To prepare the data for analysis, I renamed some columns, created a new one, 'has_breed', and replaced some of the values.

```{r echo=FALSE, warning=FALSE}
shelter_data <- shelter_data%>%
  mutate(outcome_type = str_replace(outcome_type,'Rto-Adopt', 'Adoption'),
         has_breed=if_else(grepl("Mix|Domestic", breed), "No Breed", "Breed"))
colnames(shelter_data)[8] <- 'age_upon_outcome_years'
colnames(shelter_data)[31] <- 'age_upon_intake_years'
shelter_data %>%
  head(15)
```

To go on, I checked the frequencies of animals, the reason they arrived in the shelter, and their health condition.

```{r echo=FALSE}
count(shelter_data, animal_type)%>%
  hux()%>%
   set_bold(row = 1, col = everywhere) %>%
   set_bottom_border(row = 1, col = everywhere) %>% 
   set_bottom_border(final(1), everywhere)%>%
   set_width(0.7) %>%
   theme_article()%>%
   set_caption('Animal Frequencies')
```
```{r echo=FALSE}
count(shelter_data, intake_condition)%>%
  hux()%>%
   set_bold(row = 1, col = everywhere) %>%
   set_bottom_border(row = 1, col = everywhere) %>% 
   set_bottom_border(final(1), everywhere)%>%
   set_width(0.7) %>%
   theme_article()%>%
  set_caption('Health Condition')
```
```{r echo=FALSE}
count(shelter_data, intake_type)%>%
  hux()%>%
   set_bold(row = 1, col = everywhere) %>%
   set_bottom_border(row = 1, col = everywhere) %>% 
   set_bottom_border(final(1), everywhere)%>%
   set_width(0.7) %>%
   theme_article()%>%
  set_caption('Intake Types')
```

These numbers show that the animals that arrive in this shelter are stray dogs and cats. Moreover, most of them were healthy, but there is a significant number of sick and injured pets.

For the rest of the analysis, I will focus more on dogs and cats, as they represent most of the dataset.

## Analyzing the data

First, I compared the type of intakes between dogs and cats. 

```{r echo=FALSE}
shelter_data %>%
  filter(animal_type %in% c('Dog','Cat')) %>%
  ggplot(aes(animal_type, fill=animal_type))+
  geom_bar(position = 'dodge',alpha=0.9, width=0.35)+
  geom_text(stat='count', aes(label=after_stat(count)), vjust=-0.3, size = 3.5)+
   ylim(NA, 35000)+
  scale_fill_viridis_d()+
  facet_wrap(~intake_type)+
  theme_linedraw()+
  theme(legend.position = "none",
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        panel.border = element_blank(), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), 
        axis.line = element_line(colour = "gray"))+
  labs(title='Intakes',
       x='',
       y='',
       fill='Pet')
```

Not depending on the reason, the number of dogs is always greater than the number of cats. The next step was to check their health condition.

```{r echo=FALSE}
shelter_data %>%
  filter(animal_type %in% c('Dog','Cat')) %>%
  ggplot(aes(y=animal_type, fill=fct_lump_n(intake_condition, 4) %>%
        fct_infreq()))+
  geom_bar(position = 'fill',
           alpha=0.7,
           width=0.4)+
  facet_wrap(~intake_type)+
  scale_fill_viridis_d(option='plasma')+
  scale_x_continuous(expand = c(0, 0)) +
  theme_linedraw()+
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.border = element_blank(), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), 
        axis.line = element_line(colour = "grey"))+
  labs(title='Intakes ',
       subtitle = 'Reasons for being in shelter and health state',
       x='',
       y='',
       fill='Condition')
```


As can be seen, the animals brought with a euthanized request are mainly sick or injured. The stray pets and the ones surrendered by owners were healthy.

Let us check if the age of animals influences the owners' decision to surrender them.

```{r echo=FALSE}
shelter_data %>%
  filter(animal_type %in% c('Dog','Cat')) %>%
  filter(intake_type %in% c('Owner Surrender')) %>%
  ggplot(aes(x=age_upon_intake_years,
             color=animal_type, 
             fill=animal_type))+
  geom_density(alpha=0.7,
               position='identity')+
  scale_x_continuous(expand = c(0, 0.25))+
  scale_y_continuous(expand = c(0, 0))+
  scale_fill_viridis_d()+
  scale_color_viridis_d()+
  theme_linedraw()+
  theme(legend.position = 'top',
        legend.margin=margin(b=-25),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        panel.border = element_blank(), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), 
        axis.line = element_line(colour = "black"))+
  labs(title='Surrenders',
       subtitle = 'Pets age',
       fill = 'Pet',
       color= 'Pet',
       x='',
       y='')

```


The old pets are not brought into shelters. Thus there is no clear explanation for owners to surrender their pets.


Let us go further and compare the pets' outcomes and their type of intake.

```{r echo=FALSE}
shelter_data %>%
  drop_na(outcome_type, intake_type) %>%
  filter(animal_type %in% c('Dog','Cat')) %>%
  ggplot(aes(x=reorder(fct_lump_n(outcome_type, 4) %>% 
                       fct_infreq(), outcome_type, function(x) length(x)), 
        fill=animal_type))+
  geom_bar(position = position_dodge2(preserve = "single"), 
           alpha=0.8, 
           width=0.6)+
  facet_grid(~fct_lump_n(intake_type,2))+
  coord_flip()+
  scale_fill_viridis_d()+
  scale_y_continuous(expand = c(0, 0)) +
  theme_linedraw()+
  theme(legend.position = 'top',
        legend.margin=margin(t=-5, b=-5),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.border = element_blank(), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), 
        axis.line = element_line(colour = "gray"))+
  labs(title='Outcomes',
       caption='Outcome Types Compared to Intake Reasons',
       x='',
       y='',
       fill='Pet')
```

For both cats and dogs, we may observe that a significant number of stray pets had been adopted or transferred to facilities for adoption in barn environments. More than this, many of them are returning to their owners, meaning that they were lost. Even though, the animals surrendered by their owners rarely are returned. 

Now let us deepen the analysis of the outcomes. 

### Transferred pets

45% of cats, but significantly fewer dogs, 21%, have been transferred to facilities for adoption into a barn environment.

```{r echo=FALSE}
total_num_of_cats <- shelter_data %>%
                     filter(animal_type=='Cat') %>% 
                     nrow()
total_num_of_dogs <- shelter_data %>% 
                     filter(animal_type=='Dog') %>%
                     nrow()
total_pets <- total_num_of_cats+total_num_of_dogs

shelter_data %>%
  filter(animal_type %in% c('Dog')) %>%
  filter(outcome_type == 'Transfer') %>%
  group_by(animal_type) %>%
  summarize(number = n(), percentage = percent(number/total_num_of_dogs)) %>%
  hux()%>%
   set_bold(row = 1, col = everywhere) %>%
   set_bottom_border(row = 1, col = everywhere) %>% 
   set_bottom_border(final(1), everywhere)%>%
   set_width(0.7) %>%
   set_align(everywhere, 3, "right")%>%
   theme_article()%>%
   set_caption('Transferred Dogs')

shelter_data %>%
  filter(animal_type %in% c('Cat')) %>%
  filter(outcome_type == 'Transfer') %>%
  group_by(animal_type) %>%
  summarize(number = n(), percentage = percent(number/total_num_of_cats))%>%
  hux()%>%
   set_bold(row = 1, col = everywhere) %>%
   set_bottom_border(row = 1, col = everywhere) %>% 
   set_bottom_border(final(1), everywhere)%>%
   set_width(0.7) %>%
   set_align(everywhere, 3, "right")%>%
   theme_article()%>%
   set_caption('Transferred Cats')
``` 

### Returned to owner

A small number of surrendered pets return to their owners. 

```{r echo=FALSE}
surrendered_cats<- shelter_data %>%
                     filter(animal_type %in% c('Cat')) %>%
                     filter(intake_type=='Owner Surrender')%>%
                     nrow()
shelter_data %>%
  filter(animal_type %in% c('Cat')) %>%
  filter(intake_type == 'Owner Surrender') %>%
  filter(outcome_type =='Return to Owner') %>%
  group_by(animal_type) %>%
  summarize(number = n(), percentage = percent(number/surrendered_cats))%>%
  hux()%>%
   set_bold(row = 1, col = everywhere) %>%
   set_bottom_border(row = 1, col = everywhere) %>% 
   set_bottom_border(final(1), everywhere)%>%
   set_width(0.7) %>%
   set_align(everywhere, 3, "right")%>%
   theme_article()%>%
   set_caption('Cats Returned to Owner')


surrendered_dogs<- shelter_data %>%
                     filter(animal_type %in% c('Dog')) %>%
                     filter(intake_type=='Owner Surrender')%>%
                     nrow()
shelter_data %>%
  filter(animal_type %in% c('Dog')) %>%
  filter(intake_type == 'Owner Surrender') %>%
  filter(outcome_type =='Return to Owner') %>%
  group_by(animal_type) %>%
  summarize(number = n(), percentage = percent(number/surrendered_dogs))%>% 
  hux()%>%
   set_bold(row = 1, col = everywhere) %>%
   set_bottom_border(row = 1, col = everywhere) %>% 
   set_bottom_border(final(1), everywhere)%>%
   set_width(0.7) %>%
   set_align(everywhere, 3, "right")%>%
   theme_article()%>%
   set_caption('Dogs Returned to Owner')
```                   

### Euthanisied pets

Let us see the reasons for euthanization.

```{r echo=FALSE}
shelter_data %>%
  drop_na(outcome_subtype) %>%
  filter(animal_type %in% c('Dog','Cat')) %>%
  filter(outcome_type=='Euthanasia')%>%
  ggplot(aes(x=reorder(fct_lump_n(outcome_subtype, 4) %>% fct_infreq(), outcome_type, function(x) - length(x)),fill=animal_type))+
  geom_bar(position = position_dodge2(preserve = "single"), alpha=0.8, width=0.5)+
  scale_fill_viridis_d()+
  scale_y_continuous(expand = c(0, 0)) +
  theme_linedraw()+
  theme(legend.position = 'bottom',
        legend.margin=margin(b=-3,t=-20),
        panel.border = element_blank(), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), 
        axis.line = element_line(colour = "gray"))+
  labs(title='Euthanasia Reasons',
       x='',
       y='',
       fill='Pet')
```

Many euthanized animals were sick or suffering. Dogs tend to be aggressive and have bad behavior. As it is common that some breeds tend to be more aggressive than others, I wanted to check the top 5 breeds known for their aggressivity in my dataset. 


```{r echo=FALSE}
agg_euthanasied_dogs <- shelter_data %>%
                     filter(animal_type %in% c('Dog')) %>%
                     filter(outcome_type=='Euthanasia')%>%
                     filter(outcome_subtype %in% c('Aggresive', 'Behavior')) %>%
                     nrow()
shelter_data %>%
  drop_na(outcome_subtype) %>%
  filter(animal_type %in% c('Dog')) %>%
  filter(outcome_type == 'Euthanasia') %>%
  filter(outcome_subtype %in% c('Aggresive', 'Behavior')) %>%
  group_by(breed) %>%
  summarize(number = n(), percentage = percent(number/agg_euthanasied_dogs)) %>%
  arrange(desc(number)) %>%
  head(5)%>%
  hux()%>%
  set_bold(row = 1, col = everywhere) %>%
   set_bottom_border(row = 1, col = everywhere) %>% 
   set_bottom_border(final(1), everywhere)%>%
   set_width(0.7) %>%
   set_align(everywhere, 3, "right")%>%
   theme_article()%>%
   set_caption('Euthanasied Breeds')
```


### Adoptions

For a general overview, I created two graphs to observe the comparison between intakes and adoptions over years, in absolute values. Out of the total number of pets in the shelter,  less than half are adopted. 

```{r echo=FALSE}
shelter_data %>%
  filter(animal_type %in% c('Dog','Cat')) %>%
  ggplot(aes(x=intake_year,  fill=after_stat(count)))+
  geom_bar(position='identity', width=0.7, alpha=0.6)+
  geom_text(stat='count', aes(label=after_stat(count)), position = position_stack(vjust = 0.5), size = 3.5)+
  facet_grid(~animal_type)+
  scale_y_continuous(expand=c(0,0))+
  scale_fill_binned(type = "viridis", option='mako')+
  theme_linedraw()+
  theme(legend.position='none',
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        panel.border = element_blank(), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), 
        axis.line = element_line(colour = "black"))+
  labs(title='Intakes',
       subtitle ='Number of intakes by year',
       y='',
       x='')
```


```{r echo=FALSE}
shelter_data %>%
  filter(animal_type %in% c('Dog','Cat')) %>%
  filter(outcome_type %in% c('Adoption')) %>%
  ggplot(aes(x=outcome_year,  fill=after_stat(count)))+
  geom_bar(position='identity',alpha=0.6, width=0.7)+
  geom_text(stat='count', aes(label=after_stat(count)), position = position_stack(vjust = 0.5), size=3.5)+
  facet_grid(~animal_type)+
  scale_y_continuous(expand=c(0,0))+
  scale_fill_viridis_c(option='mako')+
  theme_linedraw()+
  theme(legend.position='none',
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        panel.border = element_blank(), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), 
        axis.line = element_line(colour = "black"))+
  labs(title='Adoptions',
       subtitle ='Number of adoptions by year',
       y='',
       x='')
```

For both, cats and dogs, slightly less than half were adopted. 

```{r echo=FALSE}
shelter_data %>%
  filter(animal_type %in% c('Dog')) %>%
  filter(outcome_type == 'Adoption') %>%
  group_by(animal_type) %>%
  summarize(number = n(), percentage = percent(number/total_num_of_dogs)) %>%
  hux()%>%
  set_bold(row = 1, col = everywhere) %>%
   set_bottom_border(row = 1, col = everywhere) %>% 
   set_bottom_border(final(1), everywhere)%>%
   set_width(0.7) %>%
   set_align(everywhere, 3, "right")%>%
   theme_article()%>%
   set_caption('Adopted Dogs')

shelter_data %>%
  filter(animal_type %in% c('Cat')) %>%
  filter(outcome_type == 'Adoption') %>%
  group_by(animal_type) %>%
  summarize(number = n(), percentage = percent(number/total_num_of_cats)) %>%
  hux()%>%
  set_bold(row = 1, col = everywhere) %>%
   set_bottom_border(row = 1, col = everywhere) %>% 
   set_bottom_border(final(1), everywhere)%>%
   set_width(0.7) %>%
   set_align(everywhere, 3, "right")%>%
   theme_article()%>%
   set_caption('Adopted Cats')

```

I first checked if the age of pets and the breed influence the adoptions. 

```{r echo=FALSE}
shelter_data %>%
  filter(animal_type %in% c('Dog','Cat')) %>%
  filter(outcome_type %in% c('Adoption')) %>%
  ggplot(aes(x=age_upon_outcome_years, fill=animal_type, color=animal_type))+
  geom_density(position='identity', alpha=0.7)+
  facet_grid(~has_breed)+
  scale_x_continuous(expand = c(0, 0.25))+
  scale_y_continuous(expand = c(0, 0)) +
  scale_fill_viridis_d()+
  scale_color_viridis_d()+
  theme_linedraw()+
  theme(legend.position = 'top',
        panel.border = element_blank(), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), 
        axis.line = element_line(colour = "black"))+
  labs(title='Adoptions',
       subtitle = 'Pet age',
       x='',
       y='',
       fill='Pet',
       color='Pet')

```


At a young age, more kittens are adopted compared to puppies. But right after one year old, dogs are preferred. Having or not a breed seems to influence a bit the dogs' adoptions, but just at a young age 

Now let us observe how the genders influence people's decisions.

```{r echo=FALSE}
shelter_data %>%
  drop_na(outcome_type, sex_upon_outcome) %>%
  filter(animal_type %in% c('Dog', 'Cat')) %>%
  filter(sex_upon_outcome != 'Unknown') %>%
  filter(outcome_type %in% c('Adoption')) %>%
  ggplot(aes(y=sex_upon_outcome, fill=animal_type))+
  geom_bar(position=position_dodge2(preserve = "single"),alpha=0.8, width=0.5)+
  scale_fill_viridis_d()+
  scale_x_continuous(expand=c(0,0))+
  scale_y_discrete(labels = function(x) str_wrap(x, width = 10))+
  coord_flip()+
  theme_linedraw()+
  theme(legend.position = 'right',
        panel.border = element_blank(), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), 
        axis.line = element_line(colour = "gray"))+
  labs(title='Adoptions',
       subtitle = 'Pet genders',
       x='',
       y='',
       fill='')

```

We may observe a very slight difference between the genders. Compared to dogs, females are preferred when talking about cats.

One more thing that may influence people's decisions may be the color of the fur.

```{r echo=FALSE}
ad_cats <- shelter_data %>%
                     filter(animal_type=='Cat') %>% 
                     filter(outcome_type=='Adoption') %>%
                     nrow()
ad_dogs <- shelter_data %>% 
                     filter(animal_type=='Dog') %>%
                     filter(outcome_type=='Adoption') %>%
                     nrow()
shelter_data %>%
  filter(animal_type %in% c('Cat')) %>%
  filter(outcome_type == 'Adoption') %>%
  group_by(color) %>%
  summarize(number = n(), percentage = percent(number/ad_cats)) %>%
  arrange(desc(number)) %>%
  head(5)%>%
  hux()%>%
  set_bold(row = 1, col = everywhere) %>%
   set_bottom_border(row = 1, col = everywhere) %>% 
   set_bottom_border(final(1), everywhere)%>%
   set_width(0.7) %>%
   set_align(everywhere, 3, "right")%>%
   theme_article()%>%
   set_caption('Cats Fur Colour')


shelter_data %>%
  filter(animal_type %in% c('Dog')) %>%
  filter(outcome_type == 'Adoption') %>%
  group_by(color) %>%
  summarize(number = n(), percentage = percent(number/ad_dogs)) %>%
  arrange(desc(number)) %>%
  head(5)%>%
  hux()%>%
   set_bold(row = 1, col = everywhere) %>%
   set_bottom_border(row = 1, col = everywhere) %>% 
   set_bottom_border(final(1), everywhere)%>%
   set_width(0.7) %>%
   set_align(everywhere, 3, "right")%>%
   theme_article()%>%
   set_caption('Dogs Fur Colour')
```


As shown in the numbers, black and white fur dogs are desired, and brown and black fur cats. 


To conclude, we observed that it is difficult to find an explicit reason for surrendering pets. The animals arrive at euthanization because of their unfortunate fate and lack of love. The transfers do not result in an additional benefit for the animals, shelters, or the population at large. But the substantial number of adoptions restores hope that pets may gain a second chance. 



